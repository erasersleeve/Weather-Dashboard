<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>
    <title>Weather Dashboard</title>
</head>
<body class="container">
    <header class="jumbotron text-center">
        <h1 class="display-3">Weather Dashboard</h1>
    </header>
    
    



    

    <main class="row">    
        <section class= "col-3">
            <table class="table">
                <thead>
                    <tr>
                        <th class="row"scope=col>
                            <div class="col-xs-2">
                                <input type="text" id="searchBox" class="form-control" placeholder="Enter Location">
                            </div>
                            <div class="col-xs-2">    
                                <button id="searchBtn" class="btn btn-dark">Go</button>
                            </div>
                        </th>
                    </tr>
                </thead>



                <tbody>
                    <tr>
                        <td>Results Here</td>   
                    </tr>
                </tbody>
            </table>
        </section>
        <section class = "col-9">
            <div class="row">
                <div class="card" style="width:85%;">
                    <div class= "daily card-body">
                        <div id="daily-header" class="card-title"></div>
                        <div id="daily-temph" class="card-text"></div>
                        <div id="daily-templ" class="card-text"></div>
                        <div id="daily-humid" class="card-text"></div>
                        <div id="daily-wind" class="card-text"></div>
                        <div id="daily-uv" class="card-text"></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <h2>5-Day Forecast:</h2>
            </div>
            <div id="forecast" class="row">
                
                </div>
            </div>
        </section>
    </main>    


    <footer>

    </footer>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script type ="text/javascript">
    //on click search the database for the city in the searchbar, return data, and assign data to report locations
//         $("#searchBtn").on("click", function(){

//             var queryURL = "api.openweathermap.org/data/2.5/weather?q={city name}&appid={53f6e5db37a0164708effe3dc2b4c1f5}";
// â€‹
//             $.ajax({
//             url: queryURL,
//             method: "GET"
//             }).then(function(response) {
//             console.log(response);
                    

//         })
            var apiKey ="53f6e5db37a0164708effe3dc2b4c1f5";
            var apiKeygeo ="1a03715b66bc48b7993507324b4592ea";
            
            
            
                       


			//format("LL") gets rid of the extra information from momentjs.
			var date = moment().format("LL");
		    
		
         




         
            $("#searchBtn").on("click", function (event){
                        //empty card for new data
                        $("#daily-header").empty()
                        $("#daily-temph").empty()
                        $("#daily-templ").empty()
                        $("#daily-humid").empty()
                        $("#daily-wind").empty()
                        $("#daily-uv").empty()
                var cityName = $("#searchBox").val();
                var geoUrl = "https://api.opencagedata.com/geocode/v1/json?q="+cityName+"&key="+apiKeygeo;
                $.ajax({
                   url:geoUrl,
                   method:"GET"
                }).then(function(geolocate,){
                   console.log(geolocate.results[0].geometry.lng);
                   var lat = geolocate.results[0].geometry.lat;
                   var lng = geolocate.results[0].geometry.lng;
                   console.log(lat);
                   console.log(lng);
                   var weatherUrl = "https://api.openweathermap.org/data/2.5/onecall?lat="+lat+"&lon="+lng+"&exclude={current,minutely,hourly}&appid="+apiKey;
                   $.ajax({
                    url: weatherUrl,
                    method: "GET"
                    }).then(function(weather) {
                        //populate main card with data
                        $("#daily-header").prepend(cityName+" "+date);
                        $("#daily-temph").prepend("Temperature High: " +weather.daily[0].temp.max+"K");
                        $("#daily-templ").prepend("Temperature Low: " +weather.daily[0].temp.min+"K");
                        $("#daily-humid").prepend("Humidity: " +weather.daily[0].humidity+"%");
                        $("#daily-wind").prepend("Wind Speed: " +weather.daily[0].wind_speed+"m/s");
                        $("#daily-uv").prepend("UV Index: "  +weather.daily[0].uvi);
                        for (i=0; i<5; i++) {   
                            data1= ($("*[data-cnt]"));
                            cardCount=data1[i];
                            castDate = moment().add(i+1,'days').format('LL');
                            var card = $("<div>");
                            var cardBody = $("<div>");
                            card.attr("style", "width:8rem; margin:10px");
                            cardBody.attr("class", "card-body")
                            var cardDate = $("<div>");        
                            cardDate.text(castDate);
                            var cardIcon = $("<div>");  
                            // cardIcon.text(weather.daily[0].weather[0].id);
                            var iconImg = $("<img>");
                            var iconCode = weather.daily[i].weather[0].icon;
                            var iconUrl = "http://openweathermap.org/img/w/" + iconCode + ".png";
                            iconImg.attr('src', iconUrl);
                            cardIcon.append(iconImg);
                            var cardTemp = $("<div>");
                            cardTemp.text("Temp: "+weather.daily[i].feels_like.day)
                            var cardHumidity = $("<div>");
                            cardHumidity.text("Humidity: "+weather.daily[i].humidity+"%");
                            

                            cardBody.append(cardDate);
                            cardBody.append(cardIcon);
                            cardBody.append(cardTemp);
                            cardBody.append(cardHumidity);
                            card.append(cardBody);
                            $("#forecast").append(card);                
                        }
                
                })
                
                       
                })

                
            })   
            
    </script>
    
</body>
</html>